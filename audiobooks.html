<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Audiobooks ¬∑ iD01t Productions</title>
  <meta name="description" content="Audiobooks by iD01t Productions ‚Äî narrated titles, spoken word, and audio editions. Live from Google Books API."/>
  <link rel="canonical" href="https://id01t.github.io/audiobooks.html"/>
  <meta name="theme-color" content="#16185c"/>
  <meta property="og:type" content="website"/>
  <meta property="og:title" content="Audiobooks ¬∑ iD01t Productions"/>
  <meta property="og:description" content="Browse narrated titles and audio editions by Guillaume Lessard."/>
  <meta property="og:image" content="https://id01t.github.io/assets/img/placeholders/card-square-640.webp"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="Audiobooks ¬∑ iD01t Productions"/>
  <meta name="twitter:description" content="Narrated titles and audio editions."/>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config={theme:{extend:{colors:{brand:{50:"#f5f6ff",100:"#e6e9ff",200:"#c9ccff",300:"#a2a8ff",400:"#7a82ff",500:"#545cff",600:"#3a3fe6",700:"#2c30b4",800:"#202383",900:"#16185c"}}}}};</script>
  <link rel="stylesheet" href="/css/custom.css">
  <script>(function(){const s=localStorage.getItem('theme');const d=matchMedia('(prefers-color-scheme: dark)').matches;if(s==='dark'||(!s&&d))document.documentElement.classList.add('dark');})();</script>

  <link rel="preconnect" href="https://www.googleapis.com">
</head>
<body class="bg-white text-slate-800 dark:bg-slate-950 dark:text-slate-100">
  
<header class="sticky top-0 z-50 backdrop-blur supports-backdrop-blur:bg-white/70 bg-white/70 dark:bg-slate-950/60 border-b border-slate-200/60 dark:border-slate-800">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <a href="/" class="flex items-center gap-2" aria-label="Home">
        <img src="/assets/img/brand/logo.png" class="h-8 w-8" alt="iD01t Productions">
        <span class="font-semibold tracking-tight">iD01t Productions</span>
      </a>
      <nav class="hidden md:flex items-center gap-6" aria-label="Primary">
        <a href="/store.html" class="link-underline">Store</a> <a href="/ebooks.html" class="link-underline">eBooks</a> <a href="/audiobooks.html" class="link-underline">Audiobooks</a> <a href="/apps.html" class="link-underline">Apps</a> <a href="/games.html" class="link-underline">Games</a> <a href="/music.html" class="link-underline">Music</a> <a href="/blog.html" class="link-underline">Blog</a> <a href="/about.html" class="link-underline">About</a> <a href="/contact.html" class="link-underline">Contact</a>
      </nav>
      <div class="flex items-center gap-3">
        <button id="themeToggle" class="rounded-full border border-slate-300 dark:border-slate-700 px-3 py-1 text-sm">Theme</button>
        <a href="/#newsletter" class="inline-flex items-center rounded-full bg-brand-600 hover:bg-brand-700 text-white text-sm px-4 py-2">Newsletter</a>
        <button id="mobileMenuBtn" class="md:hidden inline-flex items-center justify-center p-2 rounded-lg border border-slate-300 dark:border-slate-700" aria-label="Open menu">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M3 12h18M3 18h18"/></svg>
        </button>
      </div>
    </div>
  </div>
  <div id="mobileMenu" class="md:hidden hidden border-t border-slate-200 dark:border-slate-800" role="dialog" aria-modal="true">
    <div class="px-4 py-3 flex flex-col gap-2">
      <a href="/store.html" class="py-2">Store</a><a href="/ebooks.html" class="py-2">eBooks</a><a href="/audiobooks.html" class="py-2">Audiobooks</a><a href="/apps.html" class="py-2">Apps</a><a href="/games.html" class="py-2">Games</a><a href="/music.html" class="py-2">Music</a><a href="/blog.html" class="py-2">Blog</a><a href="/about.html" class="py-2">About</a><a href="/contact.html" class="py-2">Contact</a>
    </div>
  </div>
</header>

  <!-- Hero -->
  <section class="relative overflow-hidden">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 pt-12 pb-6 text-center">
      <h1 class="text-4xl sm:text-5xl font-bold tracking-tight">Audiobooks</h1>
      <p class="mt-3 text-slate-600 dark:text-slate-300">Narrated editions and spoken word, auto populated from Google Books.</p>
      <p class="mt-1 text-xs text-slate-500">Updated September 06, 2025</p>
    </div>
  </section>

  <!-- Controls -->
  <section class="pb-4 border-t border-slate-200 dark:border-slate-800">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="grid gap-3 md:grid-cols-12 items-end">
        <div class="md:col-span-6">
          <input id="q" type="search" placeholder="Search title, author, keywords" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 p-3" />
        </div>
        <div class="md:col-span-2">
          <select id="language" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 p-3">
            <option value="">All languages</option>
          </select>
        </div>
        <div class="md:col-span-2">
          <input id="from" type="number" inputmode="numeric" placeholder="From year" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 p-3" />
        </div>
        <div class="md:col-span-2">
          <input id="to" type="number" inputmode="numeric" placeholder="To year" class="w-full rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 p-3" />
        </div>
        <div class="md:col-span-12 flex gap-2">
          <select id="sort" class="rounded-xl border border-slate-300 dark:border-slate-700 bg-white dark:bg-slate-900 p-3">
            <option value="date_desc">Newest</option>
            <option value="date_asc">Oldest</option>
            <option value="title_asc">Title A‚ÄîZ</option>
            <option value="title_desc">Title Z‚ÄîA</option>
          </select>
          <button id="reset" class="text-sm px-3 py-2 rounded-lg border border-slate-300 dark:border-slate-700">Reset</button>
          <span id="tally" class="text-sm text-slate-500 ml-auto"></span>
        </div>
      </div>
    </div>
  </section>

  <!-- Grid -->
  <section class="py-8 border-t border-slate-200 dark:border-slate-800">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold">Catalog</h2>
        <span id="count" class="text-sm text-slate-500"></span>
      </div>
      <div id="loading" class="text-center text-slate-500 mt-8">üéß Loading iD01t Productions audiobooks‚Ä¶</div>
      <div id="grid" class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3 mt-4 hidden"></div>
<noscript><div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 text-slate-500 py-4">Enable JavaScript to view the audiobooks catalog.</div></noscript>
      <div id="empty" class="text-slate-500 mt-4 hidden">No results. Try different filters.</div>
    </div>
  </section>

<footer class="py-10 border-t border-slate-200 dark:border-slate-800">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6">
      <div>
        <p class="font-semibold">iD01t Productions</p>
        <p class="text-sm text-slate-500">¬© <span id="year"></span> All rights reserved</p>
      </div>
      <nav class="flex flex-wrap gap-4 text-sm">
        <a href="/legal/terms.html" class="link-underline">Terms</a>
        <a href="/legal/privacy.html" class="link-underline">Privacy</a>
        <a href="/legal/refunds.html" class="link-underline">Refunds</a>
        <a href="https://github.com/id01t" class="link-underline" target="_blank" rel="noopener">GitHub</a>
        <a href="https://id01t.itch.io" class="link-underline" target="_blank" rel="noopener">itch.io</a>
      </nav>
    </div>
  </div>
</footer>

  <script>
    // Theme and mobile menu functionality
    document.getElementById('year').textContent = new Date().getFullYear();
    
    const themeToggle = document.getElementById('themeToggle');
    if (themeToggle) {
      themeToggle.addEventListener('click', function() {
        const isDark = document.documentElement.classList.toggle('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        themeToggle.setAttribute('aria-pressed', String(isDark));
      });
    }
    
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const mobileMenu = document.getElementById('mobileMenu');
    if (mobileMenuBtn && mobileMenu) {
      mobileMenuBtn.addEventListener('click', function() {
        mobileMenu.classList.toggle('hidden');
      });
    }

    // Networking helpers
    function sleep(ms){ return new Promise(r=>setTimeout(r, ms)); }
    async function fetchWithTimeout(url, opts={}, timeout=9000){
      const ctrl = new AbortController();
      const id = setTimeout(()=>ctrl.abort(), timeout);
      try{
        const res = await fetch(url, { ...opts, signal: ctrl.signal, cache: 'no-store' });
        return res;
      } finally { clearTimeout(id); }
    }

    // Local landing page resolver
    async function resolveLocalLanding(book) {
      async function exists(url) {
        try {
          const res = await fetchWithTimeout(url, { method: 'HEAD' }, 4000);
          return res.ok;
        } catch (e) {
          try {
            const res = await fetchWithTimeout(url, { method: 'GET' }, 6000);
            return res.ok;
          } catch (e2) {
            return false;
          }
        }
      }

      const safe = s => (s || '')
        .toLowerCase()
        .normalize('NFKD')
        .replace(/[\u0300-\u036f]/g, '')
        .replace(/&/g, ' and ')
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/^-+|-+$/g, '');

      const titleSlug = safe(book.title);
      const authorSlug = safe((book.authors || '').split(',')[0]);
      
      const candidates = [
        `/audiobooks/${titleSlug}.html`,
        `/audiobooks/${titleSlug}/index.html`,
        `/audiobooks/${authorSlug}-${titleSlug}.html`,
        `/audiobooks/${authorSlug}/${titleSlug}.html`,
      ];

      // Check manual mapping first
      const MAP = window.AUDIOBOOK_MAP || {};
      if (MAP[book.id]) {
        const mapped = MAP[book.id];
        if (await exists(mapped)) return mapped;
      }

      // Check generated paths
      for (const path of candidates) {
        if (await exists(path)) return path;
      }

      return null;
    }

    
    // Fallback loaders
    async function loadWindowFallback(){
      try{
        if (window.AUDIOBOOK_FALLBACK && Array.isArray(window.AUDIOBOOK_FALLBACK.items)){
          const fb = window.AUDIOBOOK_FALLBACK.items;
          return fb.map(a => ({
            id: a.id || a.title,
            title: a.title,
            authors: (a.authors || a.narrators || []).join(', '),
            year: a.year,
            language: a.language,
            categories: [a.genre].filter(Boolean),
            description: a.description || '',
            image: a.cover || '/assets/img/placeholders/card-portrait-384x576.webp',
            infoLink: a.googleBooks || a.googlePlay || a.url || '#',
            isAudiobook: true,
            localUrl: a.url || null
          }));
        }
      }catch(e){}
      return null;
    }
    async function loadJsonFallback(){
      try{
        const res = await fetchWithTimeout('/assets/data/audiobooks.json', {}, 8000);
        if (!res.ok) throw new Error('fallback json http '+res.status);
        const data = await res.json();
        const arr = Array.isArray(data) ? data : (data.items || []);
        return arr.map(a => ({
          id: a.id || a.title,
          title: a.title,
          authors: (a.authors || a.narrators || []).join(', '),
          year: a.year,
          language: a.language,
          categories: [a.genre].filter(Boolean),
          description: a.description || '',
          image: a.cover || '/assets/img/placeholders/card-portrait-384x576.webp',
          infoLink: a.googleBooks || a.googlePlay || a.url || '#',
          isAudiobook: true,
          localUrl: a.url || null
        }));
      }catch(e){ return null; }
    }

    // Google Books API Configuration
    const CONFIG = {
      AUTHOR: 'Guillaume Lessard',
      PUBLISHER: 'iD01t Productions',
      PAGE_SIZE: 40,
      MAX_TOTAL: 200,
      API_KEY: "AIzaSyBpG4uswyDjQXfZbIOfW7hwg2Il0RaUYYs" // Add your API key here for higher quota
    };

    // DOM elements
    const elements = {
      q: document.getElementById('q'),
      language: document.getElementById('language'),
      from: document.getElementById('from'),
      to: document.getElementById('to'),
      sort: document.getElementById('sort'),
      reset: document.getElementById('reset'),
      grid: document.getElementById('grid'),
      empty: document.getElementById('empty'),
      count: document.getElementById('count'),
      tally: document.getElementById('tally'),
      loading: document.getElementById('loading')
    };

    // Utility functions
    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    // Fetch all books from Google Books API
    async function fetchAllBooks() {
      const baseQuery = `inauthor:"${CONFIG.AUTHOR}" OR inpublisher:"${CONFIG.PUBLISHER}"`;
      let startIndex = 0;
      let allItems = [];

      while (startIndex < CONFIG.MAX_TOTAL) {
        const params = new URLSearchParams({
          q: baseQuery,
          maxResults: CONFIG.PAGE_SIZE,
          startIndex: startIndex,
          printType: 'books',
          projection: 'full'
        });

        if (CONFIG.API_KEY) {
          params.set('key', CONFIG.API_KEY);
        }

        const url = `https://www.googleapis.com/books/v1/volumes?${params.toString()}`;
        
        let data = null;
        let success = false;

        // Retry logic
        for (let attempt = 0; attempt < 3 && !success; attempt++) {
          try {
            const response = await fetch(url, { cache: 'no-store' });
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            data = await response.json();
            success = true;
          } catch (error) {
            console.warn(`Attempt ${attempt + 1} failed:`, error);
            await sleep(350 * (attempt + 1));
          }
        }

        if (!success) {
          throw new Error('Google Books API unavailable after retries');
        }

        const pageItems = data.items || [];
        allItems.push(...pageItems);

        // If we got fewer results than requested, we've reached the end
        if (pageItems.length < CONFIG.PAGE_SIZE) break;
        
        startIndex += CONFIG.PAGE_SIZE;
      }

      return allItems;
    }

    // Check if a book is an audiobook
    function isAudiobook(volumeInfo) {
      const title = `${volumeInfo.title || ''} ${volumeInfo.subtitle || ''}`.toLowerCase();
      const categories = (volumeInfo.categories || []).join(' ').toLowerCase();
      const description = (volumeInfo.description || '').toLowerCase();
      
      const audioKeywords = [
        'audiobook', 'audio book', 'spoken word', 'narrated',
        'unabridged', 'abridged', 'narrator', 'voice'
      ];

      return audioKeywords.some(keyword => 
        title.includes(keyword) || 
        categories.includes(keyword) || 
        description.includes(keyword)
      );
    }

    // Normalize book data
    function normalizeBook(item) {
      const volumeInfo = item.volumeInfo || {};
      const imageLinks = volumeInfo.imageLinks || {};
      
      return {
        id: item.id,
        title: volumeInfo.title || 'Untitled',
        authors: (volumeInfo.authors || []).join(', '),
        year: parseInt((volumeInfo.publishedDate || '').slice(0, 4)) || null,
        language: volumeInfo.language || '',
        categories: volumeInfo.categories || [],
        description: volumeInfo.description || '',
        image: (imageLinks.thumbnail || imageLinks.smallThumbnail || '/assets/img/placeholders/card-portrait-384x576.webp')
          .replace('http://', 'https://'),
        infoLink: (volumeInfo.infoLink || volumeInfo.canonicalVolumeLink || '#')
          .replace('http://', 'https://'),
        isAudiobook: isAudiobook(volumeInfo),
        localUrl: null // Will be populated later
      };
    }

    // Populate language filter options
    function populateLanguages(books) {
      const languages = [...new Set(books.map(book => book.language).filter(Boolean))].sort();
      elements.language.innerHTML = '<option value="">All languages</option>' +
        languages.map(lang => `<option value="${lang}">${lang}</option>`).join('');
    }

    // Create book card HTML
    function createCard(book) {
      const categories = [
        book.language,
        ...(book.categories || []).slice(0, 1),
        book.isAudiobook ? 'Audiobook' : 'Book'
      ].filter(Boolean);

      const linkUrl = book.localUrl || book.infoLink;
      const linkText = book.localUrl ? 'Details' : 'Google Books';
      const linkTarget = book.localUrl ? '_self' : '_blank';
      const linkRel = book.localUrl ? 'noopener' : 'noopener nofollow';

      return `
        <article class="rounded-2xl border border-slate-200 dark:border-slate-800 overflow-hidden bg-white dark:bg-slate-900 flex flex-col">
          <img src="${book.image}" alt="${escapeHtml(book.title)} cover" class="w-full aspect-[3/4] object-cover" loading="lazy">
          <div class="p-4 flex-1 flex flex-col">
            <h3 class="font-semibold leading-snug mb-1">${escapeHtml(book.title)}</h3>
            <p class="text-xs text-slate-500 mb-2">${escapeHtml(book.authors || '')}</p>
            <div class="mt-2 mb-4 flex flex-wrap gap-2">
              ${categories.map(cat => 
                `<span class="text-xs rounded-full border border-slate-300 dark:border-slate-700 px-2 py-0.5">${escapeHtml(cat)}</span>`
              ).join('')}
            </div>
            <div class="mt-auto pt-4 flex items-center justify-between gap-2">
              <span class="text-sm text-slate-500">${book.year || ''}</span>
              <div class="flex items-center gap-2">
                <a href="${linkUrl}" target="${linkTarget}" rel="${linkRel}" 
                   class="rounded-full bg-brand-600 hover:bg-brand-700 text-white px-4 py-2 text-sm">${linkText}</a>
                ${book.localUrl ? `<a href="${book.infoLink}" target="_blank" rel="noopener nofollow" class="text-sm underline">Google Books</a>` : ''}
              </div>
            </div>
          </div>
        </article>
      `;
    }

    // Apply filters to book list
    function applyFilters(books) {
      const searchText = (elements.q.value || '').toLowerCase().trim();
      const selectedLanguage = elements.language.value;
      const fromYear = parseInt(elements.from.value) || null;
      const toYear = parseInt(elements.to.value) || null;

      let filtered = books.filter(book => {
        // Search filter
        if (searchText) {
          const searchableText = [
            book.title,
            book.authors,
            book.description,
            (book.categories || []).join(' ')
          ].join(' ').toLowerCase();
          
          if (!searchableText.includes(searchText)) return false;
        }

        // Language filter
        if (selectedLanguage && book.language !== selectedLanguage) return false;

        // Year filters
        if (fromYear && (!book.year || book.year < fromYear)) return false;
        if (toYear && (!book.year || book.year > toYear)) return false;

        // Only show audiobooks
        return book.isAudiobook;
      });

      // Sort results
      const sortBy = elements.sort.value;
      filtered.sort((a, b) => {
        switch (sortBy) {
          case 'date_asc':
            return (a.year || 0) - (b.year || 0);
          case 'title_asc':
            return a.title.localeCompare(b.title);
          case 'title_desc':
            return b.title.localeCompare(a.title);
          default: // 'date_desc'
            return (b.year || 0) - (a.year || 0);
        }
      });

      return filtered;
    }

    // Render books to the grid
    function renderBooks(filtered, allBooks) {
      elements.loading.classList.add('hidden');
      
      if (!filtered.length) {
        elements.grid.classList.add('hidden');
        elements.empty.classList.remove('hidden');
        elements.count.textContent = '0 audiobooks';
        return;
      }

      elements.empty.classList.add('hidden');
      elements.grid.classList.remove('hidden');
      elements.grid.innerHTML = filtered.map(createCard).join('');
      
      const audiobookCount = allBooks.filter(book => book.isAudiobook).length;
      elements.count.textContent = `${filtered.length} audiobook${filtered.length !== 1 ? 's' : ''}`;
      elements.tally.textContent = `${allBooks.length} titles ‚Ä¢ ${audiobookCount} audiobooks`;
      
      generateSchema(filtered);
    }

    // Generate JSON-LD schema
    function generateSchema(books) {
      const schema = {
        '@context': 'https://schema.org',
        '@type': 'ItemList',
        name: 'Audiobooks',
        itemListElement: books.slice(0, 60).map((book, index) => ({
          '@type': 'ListItem',
          position: index + 1,
          item: {
            '@type': 'Audiobook',
            name: book.title,
            inLanguage: book.language,
            datePublished: book.year ? String(book.year) : undefined,
            image: book.image,
            url: book.infoLink
          }
        }))
      };

      let scriptTag = document.getElementById('ld-audiobooks');
      if (!scriptTag) {
        scriptTag = document.createElement('script');
        scriptTag.id = 'ld-audiobooks';
        scriptTag.type = 'application/ld+json';
        document.head.appendChild(scriptTag);
      }
      scriptTag.textContent = JSON.stringify(schema);
    }

    // Setup event listeners
    function setupEventListeners(allBooks) {
      const updateResults = () => renderBooks(applyFilters(allBooks), allBooks);
      
      ['input', 'change'].forEach(eventType => {
        [elements.q, elements.language, elements.from, elements.to, elements.sort]
          .forEach(element => element.addEventListener(eventType, updateResults));
      });

      elements.reset.addEventListener('click', () => {
        elements.q.value = '';
        elements.language.value = '';
        elements.from.value = '';
        elements.to.value = '';
        elements.sort.value = 'date_desc';
        updateResults();
      });
    }

    // Throttle function for API calls
    function throttle(promises, batchSize = 6, delay = 50) {
      return promises.reduce(async (previousBatch, currentPromise, index) => {
        const results = await previousBatch;
        
        if (index % batchSize === 0 && index > 0) {
          await new Promise(resolve => setTimeout(resolve, delay));
        }
        
        const result = await currentPromise();
        results.push(result);
        return results;
      }, Promise.resolve([]));
    }

    // Load fallback data
    async function loadFallback() {
      try {
        const response = await fetch('/assets/data/audiobooks.json', { cache: 'no-store' });
        if (!response.ok) throw new Error('Fallback fetch failed');
        
        const fallbackData = await response.json();
        const items = Array.isArray(fallbackData) ? fallbackData : (fallbackData.items || []);
        
        return items.map(item => ({
          id: item.id || item.title,
          title: item.title,
          authors: (item.authors || item.narrators || []).join(', '),
          year: item.year,
          language: item.language,
          categories: [item.genre].filter(Boolean),
          description: item.description || '',
          image: item.cover || '/assets/img/placeholders/card-portrait-384x576.webp',
          infoLink: item.googleBooks || item.googlePlay || item.url || '#',
          isAudiobook: true,
          localUrl: item.url
        }));
      } catch (error) {
        console.error('Fallback loading failed:', error);
        return [];
      }
    }

    // Main initialization function
    
    async function init() {
      try {
        console.log('üéß Fetching from Google Books‚Ä¶');
        const rawBooks = await fetchAllBooks();
        let allBooks = rawBooks.map(normalizeBook);
        const audiobooks = allBooks.filter(b => b.isAudiobook);

        // Resolve local URLs with throttle
        if (audiobooks.length) {
          const tasks = audiobooks.map(b => async () => { b.localUrl = await resolveLocalLanding(b); return b; });
          for (let i=0; i<tasks.length; i+=6){ await Promise.all(tasks.slice(i,i+6).map(fn=>fn())); await sleep(60); }
        }

        populateLanguages(audiobooks);
        setupEventListeners(audiobooks);
        renderBooks(applyFilters(audiobooks), audiobooks);
      } catch (err) {
        console.warn('API failed, trying window fallback', err);
        let fb = await loadWindowFallback();
        if (!fb) {
          console.warn('Window fallback missing, trying JSON fallback');
          fb = await loadJsonFallback();
        }
        if (fb && fb.length) {
          populateLanguages(fb);
          setupEventListeners(fb);
          renderBooks(applyFilters(fb), fb);
        } else {
          document.getElementById('loading').textContent = '‚ö†Ô∏è Could not load audiobooks. Please try again later.';
          document.getElementById('empty').classList.remove('hidden');
        }
      }
    }
    
        // Resolve local URLs for audiobooks (with throttling)
        if (audiobooks.length > 0) {
          console.log('üîó Resolving local landing pages...');
          const localUrlPromises = audiobooks.map(book => async () => {
            book.localUrl = await resolveLocalLanding(book);
            return book;
          });
          
          await throttle(localUrlPromises, 5, 100); // More conservative throttling
        }
        
        console.log(`‚úÖ Final audiobook catalog: ${audiobooks.length} titles`);
        
        populateLanguages(audiobooks);
        setupEventListeners(audiobooks);
        renderBooks(applyFilters(audiobooks), audiobooks);
        
        // If we found very few results, also show what was filtered out for debugging
        if (audiobooks.length < 5) {
          console.log('‚ö†Ô∏è Low audiobook count. Checking filtered items:');
          const nonAudiobooks = allBooks.filter(book => !book.isAudiobook);
          console.log(`üìö ${nonAudiobooks.length} items filtered out as non-audiobooks:`);
          nonAudiobooks.slice(0, 10).forEach(book => {
            console.log(`  - "${book.title}" by ${book.authors}`);
            console.log(`    Reason: No clear audiobook indicators found`);
          });
        }
        
      } catch (error) {
        console.error('‚ùå Google Books API failed:', error);
        console.log('üîÑ Attempting to load fallback data...');
        
        try {
          const fallbackBooks = await loadFallback();
          console.log(`üìã Loaded ${fallbackBooks.length} books from fallback JSON`);
          
          populateLanguages(fallbackBooks);
          setupEventListeners(fallbackBooks);
          renderBooks(applyFilters(fallbackBooks), fallbackBooks);
          
        } catch (fallbackError) {
          console.error('üí• Fallback loading also failed:', fallbackError);
          elements.loading.textContent = '‚ö†Ô∏è Could not load audiobooks. Please try again later.';
          elements.empty.classList.remove('hidden');
        }
      }
    }

    // Start the application
    init();
  </script>
  <script src="/assets/data/audiobooks.js"></script>
<script src="/assets/data/audiobooks.client.js"></script>
</body>
</html>
