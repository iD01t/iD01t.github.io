<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Audiobooks • iD01t Productions</title>
  <meta name="description" content="Official audiobooks hub. Live from Google Books API. Filter by language and year. Audiobooks only." />
  <link rel="canonical" href="/audiobooks.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Audiobooks • iD01t Productions" />
  <meta property="og:description" content="Browse Guillaume Lessard’s audiobooks with direct Google Books links." />
  <meta property="og:url" content="/audiobooks.html" />
  <meta property="og:image" content="/assets/img/placeholders/card-square-640.webp" />
  <link rel="icon" href="/assets/favicon.ico" />
  <link rel="apple-touch-icon" href="/assets/logo-512.png" />
  <link rel="stylesheet" href="/assets/site.css" />
  <link rel="stylesheet" href="/css/custom.css" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: { colors: { brand: { 50:'#f5f6ff',100:'#e6e9ff',200:'#c9ccff',300:'#a2a8ff',400:'#7a82ff',500:'#545cff',600:'#3a3fe6',700:'#2c30b4',800:'#202383',900:'#16185c'}}}}
    };
  </script>

  <script>(function(){const s=localStorage.getItem('theme');const d=matchMedia('(prefers-color-scheme: dark)').matches;if(s==='dark'||(!s&&d))document.documentElement.classList.add('dark');})();</script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CHX65WY0WZ"></script>
  <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-CHX65WY0WZ');</script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GT-M39S87SN');</script>

  <style>
    :root{--border:rgba(255,255,255,.12);--card:rgba(255,255,255,.05);--muted:rgba(255,255,255,.75)}
    @media (prefers-color-scheme: dark){body{background:#0b0d10;color:#eaeaf0}}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0}
    .wrap{max-width:1200px;margin:0 auto;padding:0 20px}
    .glass{background:var(--card);backdrop-filter:blur(10px)}
    .card{border:1px solid var(--border);border-radius:16px;overflow:hidden}
    .btn{display:inline-block;padding:10px 12px;border:1px solid var(--border);border-radius:12px;text-decoration:none;color:inherit;background:rgba(255,255,255,.03)}
    .chip{font-size:.8rem;padding:4px 8px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.06)}
    header.sticky{position:sticky;top:0;z-index:50;background:rgba(11,13,16,.85);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .nav{display:flex;align-items:center;justify-content:space-between;height:60px}
    .nav a{color:inherit;text-decoration:none;margin:0 8px;opacity:.9}.nav a[aria-current="page"],.nav a:hover{opacity:1}
    .hero{padding:56px 0;background:linear-gradient(135deg,#111827 0%,#0b0d10 60%,#0b0d10 100%)}
    .hero h1{font-size:clamp(28px,4vw,44px);margin:0 0 8px}.hero p{opacity:.85;margin:0}
    .toolbar{display:grid;grid-template-columns:1.2fr 150px 150px 150px 1fr;gap:10px;align-items:end;margin:18px 0}
    .toolbar label{font-size:.85rem;color:var(--muted);display:block;margin-bottom:6px}
    .toolbar input,.toolbar select{padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:var(--card);color:inherit}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
    .muted{opacity:.8}
    footer{border-top:1px solid var(--border);padding:24px 0;margin-top:32px;opacity:.8;text-align:center}
    .grid .card img{width:100%;height:auto;aspect-ratio:3/4;object-fit:cover;max-height:320px}
    .featured .card img{max-height:260px;aspect-ratio:3/4;object-fit:cover}
    .link-underline{position:relative}.link-underline::after{content:'';position:absolute;left:0;bottom:-2px;width:100%;height:1px;background:currentColor;transform:scaleX(0);transform-origin:left;transition:transform .2s}.link-underline:hover::after{transform:scaleX(1)}
  </style>
</head>
<body>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GT-M39S87SN" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

  <!-- Header -->
  <header id="site-header" class="sticky top-0 z-50 backdrop-blur bg-white/70 dark:bg-slate-950/60 border-b border-slate-200/60 dark:border-slate-800">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <a href="/" class="flex items-center gap-2" aria-label="Home">
          <img src="/assets/img/brand/logo.png" class="h-8 w-8" alt="iD01t Productions">
          <span class="font-semibold tracking-tight">iD01t Productions</span>
        </a>
        <nav class="hidden md:flex items-center gap-6" aria-label="Primary">
          <a href="/store.html" class="link-underline">Store</a>
          <a href="/ebooks.html" class="link-underline">eBooks</a>
          <a href="/audiobooks.html" class="link-underline" aria-current="page">Audiobooks</a>
          <a href="/apps.html" class="link-underline">Apps</a>
          <a href="/games.html" class="link-underline">Games</a>
          <a href="/music.html" class="link-underline">Music</a>
          <a href="/blog.html" class="link-underline">Blog</a>
          <a href="/about.html" class="link-underline">About</a>
          <a href="/contact.html" class="link-underline">Contact</a>
        </nav>
        <div class="flex items-center gap-3">
          <button id="themeToggle" class="rounded-full border border-slate-300 dark:border-slate-700 px-3 py-1 text-sm">Theme</button>
          <a href="/#newsletter" class="inline-flex items-center rounded-full bg-brand-600 hover:bg-brand-700 text-white text-sm px-4 py-2">Newsletter</a>
          <button id="mobileMenuBtn" class="md:hidden inline-flex items-center justify-center p-2 rounded-lg border border-slate-300 dark:border-slate-700" aria-label="Open menu">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M3 12h18M3 18h18"/></svg>
          </button>
        </div>
      </div>
    </div>
    <div id="mobileMenu" class="md:hidden hidden border-t border-slate-200 dark:border-slate-800" role="dialog" aria-modal="true">
      <div class="px-4 py-3 flex flex-col gap-2">
        <a href="/store.html" class="py-2">Store</a>
        <a href="/ebooks.html" class="py-2">eBooks</a>
        <a href="/audiobooks.html" class="py-2">Audiobooks</a>
        <a href="/apps.html" class="py-2">Apps</a>
        <a href="/games.html" class="py-2">Games</a>
        <a href="/music.html" class="py-2">Music</a>
        <a href="/blog.html" class="py-2">Blog</a>
        <a href="/about.html" class="py-2">About</a>
        <a href="/contact.html" class="py-2">Contact</a>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="wrap">
      <h1>Audiobooks — iD01t Productions</h1>
      <p>Live from Google Books API. Audiobooks only with language, year, and search filters.</p>
    </div>
  </section>

  <main class="wrap">
    <!-- Toolbar -->
    <section class="toolbar">
      <div><label for="q">Search</label><input id="q" type="search" placeholder="Title or keyword"></div>
      <div><label for="language">Language</label><select id="language"></select></div>
      <div><label for="from">From year</label><input id="from" type="number" inputmode="numeric" placeholder="2018"></div>
      <div><label for="to">To year</label><input id="to" type="number" inputmode="numeric" placeholder="2025"></div>
      <div><label for="sort">Sort</label>
        <select id="sort">
          <option value="date_desc">Newest</option>
          <option value="date_asc">Oldest</option>
          <option value="title_asc">Title A–Z</option>
          <option value="title_desc">Title Z–A</option>
        </select>
      </div>
      <div class="col-span-full flex items-center gap-3">
        <button id="clear" class="btn" type="button">Clear filters</button>
        <span id="tally" class="muted" style="margin-left:auto"></span>
      </div>
    </section>

    <!-- Featured -->
    <section class="card glass featured" style="padding:16px;margin-bottom:16px">
      <div style="display:grid;grid-template-columns:1.2fr 1fr;gap:16px;align-items:center">
        <div>
          <h2 style="margin:0 0 6px">Featured Audiobook</h2>
          <p class="muted" style="margin:0 0 10px">Latest matching title from Google Books.</p>
          <div id="featured" class="card" style="overflow:hidden;border-radius:12px"></div>
        </div>
        <div>
          <h3 style="margin:0 0 6px">Narration and custom audio</h3>
          <p class="muted" style="margin:0 0 10px">Need a narrated version or custom soundtrack for your next release</p>
          <a href="/contact.html" class="btn">Get in touch</a>
        </div>
      </div>
    </section>

    <!-- Grid -->
    <section>
      <div style="display:flex;align-items:center;justify-content:space-between;margin:10px 0 14px">
        <h2 style="margin:0">Catalog</h2>
        <span id="count" class="muted" style="font-size:.9rem"></span>
      </div>
      <div id="grid" class="grid" aria-live="polite"></div>
      <div id="empty" class="muted" hidden>No results. Try different filters.</div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="py-10 border-t border-slate-200 dark:border-slate-800">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6">
        <div>
          <p class="font-semibold">iD01t Productions</p>
          <p class="text-sm text-slate-500">© <span id="year"></span> All rights reserved</p>
        </div>
        <nav class="flex flex-wrap gap-4 text-sm">
          <a href="/legal/terms.html" class="link-underline">Terms</a>
          <a href="/legal/privacy.html" class="link-underline">Privacy</a>
          <a href="/legal/refunds.html" class="link-underline">Refunds</a>
          <a href="https://github.com/id01t" class="link-underline" target="_blank" rel="noopener">GitHub</a>
          <a href="https://id01t.itch.io" class="link-underline" target="_blank" rel="noopener">itch.io</a>
        </nav>
      </div>
    </div>
  </footer>

  <script>
    // Shared header sync from index.html (optional)
    (async function loadSharedHeader(){
      try{
        const r=await fetch('/index.html');
        if(!r.ok) return;
        const h=await r.text();
        const d=new DOMParser().parseFromString(h,'text/html');
        const s=d.querySelector('#site-header');
        if(s) document.getElementById('site-header').outerHTML=s.outerHTML;
      }catch{}
    })();

    document.getElementById('year').textContent=new Date().getFullYear();

    // —— Config
    const CONFIG = {
      AUTHOR: 'Guillaume Lessard',
      PUBLISHER: 'iD01t Productions',
      PAGE_SIZE: 40,   // Google Books max page size
      MAX_TOTAL: 200,  // up to 5 pages
      API_KEY: ''      // optional
    };

    const el=id=>document.getElementById(id);
    const q=el('q'), language=el('language'), from=el('from'), to=el('to'), sort=el('sort'), clearBtn=el('clear');
    const grid=el('grid'), empty=el('empty'), count=el('count'), tally=el('tally'), featured=el('featured');

    const escapeHtml = s => String(s||'').replace(/[&<>\"]/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c]));
    const chip = t => `<span class="chip">${escapeHtml(t)}</span>`;

    // Heuristic to identify audiobooks from Google Books entries
    function isAudioBook(v){
      const t=((v.title||'')+' '+(v.subtitle||'')).toLowerCase();
      const c=(v.categories||[]).join(' ').toLowerCase();
      const s=(v.searchInfo?.textSnippet||'').toLowerCase();
      const hints=['audiobook','audio book','spoken word','narrated','unabridged','abridged'];
      return hints.some(h=>t.includes(h)||c.includes(h)||s.includes(h));
    }

    // Normalize one API item
    function normalize(item){
      const v=item.volumeInfo||{}, links=v.imageLinks||{};
      return {
        id:item.id,
        title:v.title||'Untitled',
        authors:(v.authors||[]).join(', '),
        year:(v.publishedDate||'').slice(0,4),
        language:v.language||'',
        categories:v.categories||[],
        infoLink:(v.infoLink||v.canonicalVolumeLink||'#').replace('http://','https://'),
        image:(links.thumbnail||links.smallThumbnail||'/assets/placeholder-cover.svg').replace('http://','https://')
      };
    }

    // API fetcher with paging, hard-biased to audiobooks
    async function fetchAllAudiobooks(){
      const base = `(${[
        `inauthor:"${CONFIG.AUTHOR}"`,
        `inpublisher:"${CONFIG.PUBLISHER}"`
      ].join(' OR ')}) (audiobook OR "audio book" OR "spoken word" OR narration)`;

      let startIndex = 0, items = [];
      while (startIndex < CONFIG.MAX_TOTAL){
        const p = new URLSearchParams({ q: base, maxResults: CONFIG.PAGE_SIZE, startIndex, printType:'books' });
        if (CONFIG.API_KEY) p.set('key', CONFIG.API_KEY);
        const url = `https://www.googleapis.com/books/v1/volumes?${p}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error(`Books API ${res.status}`);
        const data = await res.json();
        const page = (data.items||[]).filter(x=>isAudioBook(x.volumeInfo||{}));
        items.push(...page);
        if (!data.items || data.items.length < CONFIG.PAGE_SIZE) break;
        startIndex += CONFIG.PAGE_SIZE;
      }
      return items;
    }

    function populateLanguages(items){
      const langs=[...new Set(items.map(x=>x.language).filter(Boolean))].sort();
      language.innerHTML='<option value="">All</option>'+langs.map(l=>`<option value="${escapeHtml(l)}">${escapeHtml(l)}</option>`).join('');
    }

    function cardHTML(a){
      const tags=[a.language, ...(a.categories||[]).slice(0,1), 'Audiobook'].filter(Boolean).map(chip).join(' ');
      return `<article class="card" style="background:var(--card)">
        <img src="${escapeHtml(a.image)}" alt="${escapeHtml(a.title)} cover">
        <div class="content">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
            <h3 style="margin:0">${escapeHtml(a.title)}</h3>
            <span class="muted" style="font-size:.9rem">${escapeHtml(a.year||'')}</span>
          </div>
          <div class="muted">${escapeHtml(a.authors||'')}</div>
          <div style="display:flex;gap:6px;flex-wrap:wrap">${tags}</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <a class="btn" href="${escapeHtml(a.infoLink)}" target="_blank" rel="noopener nofollow">Google Books</a>
          </div>
        </div>
      </article>`;
    }

    function applyFilters(items){
      const text=(q.value||'').toLowerCase();
      const lang=language.value; const f=parseInt(from.value||''); const t=parseInt(to.value||'');
      let list=items.filter(x=>{
        if (text){
          const hay=[x.title,x.authors,(x.categories||[]).join(' ')].join(' ').toLowerCase();
          if(!hay.includes(text)) return false;
        }
        if (lang && x.language!==lang) return false;
        if (!isNaN(f) && (x.year||0)<f) return false;
        if (!isNaN(t) && (x.year||0)>t) return false;
        return true;
      });
      const s=sort.value, byTitle=(a,b)=>a.title.localeCompare(b.title);
      if (s==='date_asc') list.sort((a,b)=>(a.year||0)-(b.year||0));
      else if (s==='title_asc') list.sort(byTitle);
      else if (s==='title_desc') list.sort((a,b)=>byTitle(b,a));
      else list.sort((a,b)=>(b.year||0)-(a.year||0)); // newest
      return list;
    }

    function emitSchema(items){
      const ld={ '@context':'https://schema.org','@type':'ItemList', name:'Audiobooks',
        itemListElement: items.slice(0,60).map((a,i)=>({ '@type':'ListItem', position:i+1,
          item:{ '@type':'Audiobook', name:a.title, inLanguage:a.language,
                 datePublished:a.year?String(a.year):undefined, image:a.image, url:a.infoLink,
                 author:{'@type':'Person','name':CONFIG.AUTHOR} }
        }))
      };
      let tag=document.getElementById('ld-audiobooks'); if(!tag){tag=document.createElement('script');tag.id='ld-audiobooks';tag.type='application/ld+json';document.head.appendChild(tag);}
      tag.textContent=JSON.stringify(ld);
    }

    function render(list, all){
      if(!list.length){ grid.innerHTML=''; empty.hidden=false; count.textContent='0 audiobooks'; emitSchema([]); return; }
      empty.hidden=true;
      grid.innerHTML=list.map(cardHTML).join('');
      count.textContent=`${list.length} audiobook${list.length!==1?'s':''}`;
      tally.textContent = `${all.length} total audiobooks`;
      emitSchema(list);
      featured.innerHTML = cardHTML(list[0]); // newest by default
    }

    function bind(items){
      const again=()=>render(applyFilters(items), items);
      ['input','change'].forEach(e=>[q,language,from,to,sort].forEach(el=>el.addEventListener(e,again)));
      clearBtn.addEventListener('click',()=>{q.value='';language.value='';from.value='';to.value='';sort.value='date_desc';again();});
    }

    async function init(){
      try{
        const raw = await fetchAllAudiobooks();
        if(!raw.length) throw new Error('No API items');
        const all = raw.map(normalize);
        populateLanguages(all);
        bind(all);
        render(applyFilters(all), all);
      }catch(err){
        console.warn('API failed, fallback to /assets/data/audiobooks.json', err);
        try{
          const r=await fetch('/assets/data/audiobooks.json',{cache:'no-store'});
          const fb=await r.json();
          const all=(Array.isArray(fb)?fb:(fb.items||[])).map(a=>({
            id:a.id||a.title, title:a.title, authors:(a.authors||a.narrators||[]).join(', '),
            year:a.year, language:a.language, categories:[a.genre].filter(Boolean),
            infoLink:(a.googleBooks||a.googlePlay||a.url||'#'), image:a.cover
          }));
          populateLanguages(all); bind(all); render(applyFilters(all), all);
        }catch(e2){
          grid.innerHTML='<div class="muted">Could not load audiobooks from API or fallback JSON.</div>'; empty.hidden=false;
        }
      }
    }

    // Theme toggle and mobile menu
    document.getElementById('themeToggle')?.addEventListener('click',()=>{
      const d=document.documentElement; const dark=d.classList.toggle('dark');
      localStorage.setItem('theme', dark?'dark':'light');
    });
    document.getElementById('mobileMenuBtn')?.addEventListener('click',()=>{
      const m=document.getElementById('mobileMenu'); m.classList.toggle('hidden');
    });

    init();
  </script>
</body>
</html>
