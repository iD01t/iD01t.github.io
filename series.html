<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Series • iD01t Productions</title>
  <meta name="description" content="Explore book series by Guillaume Lessard and iD01t Productions. Live from Google Books API. Filter by language, year, and size." />
  <link rel="canonical" href="/series.html" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Series • iD01t Productions" />
  <meta property="og:description" content="Official book series hub grouped from Google Books API results." />
  <meta property="og:url" content="/series.html" />
  <meta property="og:image" content="/assets/img/brand/ebooks_og.jpg" />
  <link rel="icon" href="/assets/favicon.ico" />
  <link rel="apple-touch-icon" href="/assets/logo-512.png" />
  <link rel="stylesheet" href="/assets/site.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <style>
    :root{--border-light:rgba(0,0,0,.12);--card-light:rgba(0,0,0,.03);--muted-light:#6b7280;
          --border-dark:rgba(255,255,255,.12);--card-dark:rgba(255,255,255,.06);--muted-dark:rgba(255,255,255,.72)}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0}
    .wrap{max-width:1200px;margin:0 auto;padding:0 20px}
    .hero{padding:56px 0;background:linear-gradient(135deg,#111827 0%,#0b0d10 60%,#0b0d10 100%);color:#eaeaf0}
    .hero h1{font-size:clamp(28px,4vw,44px);margin:0 0 8px}
    .hero p{opacity:.85;margin:0}
    .toolbar{display:grid;grid-template-columns:1.2fr 160px 160px 160px 1fr;gap:10px;align-items:end;margin:18px 0}
    .toolbar label{font-size:.85rem;color:var(--muted);display:block;margin-bottom:6px}
    .toolbar input,.toolbar select{padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:var(--card);color:inherit}
    .toolbar .wide{grid-column:1/-1;display:flex;gap:10px;align-items:center}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}
    .card{border:1px solid var(--border);border-radius:16px;overflow:hidden;background:var(--card)}
    .series-cover{display:grid;grid-template-columns:repeat(3,1fr);gap:2px;background:#0f1115}
    .series-cover img{width:100%;aspect-ratio:3/4;object-fit:cover;background:#111}
    .content{padding:14px;display:flex;flex-direction:column;gap:8px}
    .muted{opacity:.8}
    .btn{display:inline-block;padding:10px 12px;border:1px solid var(--border);border-radius:12px;text-decoration:none;color:inherit;background:rgba(255,255,255,.03)}
    .btn:hover{filter:brightness(1.07)}
    footer{border-top:1px solid var(--border);padding:24px 0;margin-top:32px;opacity:.8;text-align:center}
    /* Light/Dark tokens */
    :root{--border:var(--border-light);--card:var(--card-light);--muted:var(--muted-light)}
    @media (prefers-color-scheme: dark){:root{--border:var(--border-dark);--card:var(--card-dark);--muted:var(--muted-dark)}}
  </style>
</head>
<body data-active="Series">
  <div id="header-slot"></div>

  <section class="hero">
    <div class="wrap">
      <h1>Book Series — iD01t Productions</h1>
      <p>Grouped live from the Google Books API. Each card links to Google Books results for instant credibility and discovery.</p>
    </div>
  </section>

  <main class="wrap" role="main">
    <!-- Filters -->
    <section class="toolbar" aria-label="Filters">
      <div>
        <label for="q">Search series</label>
        <input id="q" type="search" placeholder="Series name or keyword" />
      </div>
      <div>
        <label for="language">Language</label>
        <select id="language" aria-label="Language"></select>
      </div>
      <div>
        <label for="from">From (year)</label>
        <input id="from" type="number" inputmode="numeric" placeholder="2018" />
      </div>
      <div>
        <label for="to">To (year)</label>
        <input id="to" type="number" inputmode="numeric" placeholder="2025" />
      </div>
      <div>
        <label for="sort">Sort</label>
        <select id="sort" aria-label="Sort">
          <option value="size_desc">Most books</option>
          <option value="size_asc">Fewest books</option>
          <option value="date_desc">Newest first</option>
          <option value="date_asc">Oldest first</option>
          <option value="name_asc">Name A–Z</option>
          <option value="name_desc">Name Z–A</option>
        </select>
      </div>
      <div class="wide">
        <label class="muted"><input id="onlyComplete" type="checkbox" /> Likely complete</label>
        <button id="clear" class="btn" type="button">Clear filters</button>
        <span id="tally" class="muted" style="margin-left:auto"></span>
      </div>
    </section>

    <!-- Grid -->
    <section aria-label="Series list">
      <div style="display:flex;align-items:center;justify-content:space-between;margin:10px 0 14px">
        <h2 style="margin:0">Series Catalog</h2>
        <span id="count" class="muted" style="font-size:.9rem"></span>
      </div>
      <div id="grid" class="grid" aria-live="polite"></div>
      <div id="empty" class="muted" hidden>No series found. Try different filters.</div>
    </section>
  </main>

  <div id="footer-slot"></div>

  <!-- Inject header/footer from the ORIGINAL homepage -->
  <script>
  (async function injectLayout(){
    try{
      const res = await fetch('/index.html', {cache:'no-store'});
      const text = await res.text();
      const doc = new DOMParser().parseFromString(text, 'text/html');
      const head = document.querySelector('head');
      doc.querySelectorAll('link[rel="stylesheet"]').forEach(link => {
        const href = link.getAttribute('href');
        if (href && !document.querySelector('link[rel="stylesheet"][href="'+href+'"]')) {
          const l=document.createElement('link'); l.rel='stylesheet'; l.href=href; head.appendChild(l);
        }
      });
      const header = doc.querySelector('header'); const footer = doc.querySelector('footer');
      if (header) document.getElementById('header-slot').innerHTML = header.outerHTML;
      if (footer) document.getElementById('footer-slot').innerHTML = footer.outerHTML;
      // Active nav
      const active = (document.body.dataset.active || '').toLowerCase();
      document.querySelectorAll('header nav a, #site-header nav a').forEach(a=>{
        a.removeAttribute('aria-current');
        const label=a.textContent.trim().toLowerCase();
        const href=a.getAttribute('href');
        if ((active && label===active) || href==='/series.html') a.setAttribute('aria-current','page');
      });
      // Re-execute any scripts that were inside injected nodes
      ['header-slot','footer-slot'].forEach(id=>{
        const root=document.getElementById(id);
        root && root.querySelectorAll('script').forEach(s=>{const ns=document.createElement('script'); ns.textContent=s.textContent; s.replaceWith(ns);});
      });
    }catch(e){ console.warn('Header/Footer injection failed', e); }
  })();
  </script>

  <!-- Series logic (Google Books API) -->
  <script>
    // Config
    const CONF = {
      AUTHORS: ['Guillaume Lessard','El\'Nox Rah','DJ iD01t'],
      PUBLISHERS: ['iD01t Productions'],
      MAX_PAGES: 5,     // 5 * 40 = up to 200 items per query
      PAGE_SIZE: 40,
      API_KEY: window.GBOOKS_API_KEY || '' // optional
    };

    const el = id => document.getElementById(id);
    const $q=el('q'), $lang=el('language'), $from=el('from'), $to=el('to'), $sort=el('sort'),
          $complete=el('onlyComplete'), $clear=el('clear'),
          $grid=el('grid'), $empty=el('empty'), $count=el('count'), $tally=el('tally');

    const esc=s=>String(s||'').replace(/[&<>"]/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;",""":"&quot;"}[c]));

    // Build HD cover from volume id
    const coverById = (id,z=3)=>`https://books.google.com/books/content?id=${id}&printsec=frontcover&img=1&zoom=${z}&source=gbs_api`;

    // Fetch helper with paging
    async function fetchVolumes(query){
      const key = CONF.API_KEY ? `&key=${encodeURIComponent(CONF.API_KEY)}` : '';
      let all=[]; let start=0;
      for (let i=0;i<CONF.MAX_PAGES;i++){
        const url = `https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}&printType=books&maxResults=${CONF.PAGE_SIZE}&startIndex=${start}${key}`;
        const res = await fetch(url); if(!res.ok) break;
        const data = await res.json(); const items=data.items||[];
        if(!items.length) break;
        all.push(...items); start += CONF.PAGE_SIZE;
        if (start >= (data.totalItems||0)) break;
      }
      return all;
    }

    function normalize(v){
      const vi=v.volumeInfo||{}, si=v.saleInfo||{};
      const title = vi.title||'Untitled';
      const series = extractSeriesFromTitle(title, vi.subtitle||'', vi.description||'', vi.searchInfo?.textSnippet||'');
      return {
        id:v.id, title,
        subtitle:vi.subtitle||'',
        language:(vi.language||'').toUpperCase(),
        year:(vi.publishedDate||'').slice(0,4),
        categories:vi.categories||[],
        cover: coverById(v.id,3),
        cover2x: coverById(v.id,4),
        info: (vi.infoLink||vi.canonicalVolumeLink||v.selfLink||'#').replace('http://','https://'),
        buy: si.buyLink || vi.infoLink || '',
        series // {name, num} | null
      };
    }

    // Heuristics for extracting series name/number from title/subtitle/description
    const RX = [
      // "Title (Series Name Book 2)" or "(Series Name #2)"
      /\(([^)]+?)\s*(?:book|livre|tome|volume|vol\.?|#)\s*\d+[^)]*\)/i,
      // "Series Name: Book 3" as prefix
      /^(.*?)\s*[:\-]\s*(?:book|livre|tome|volume|vol\.?|#)\s*\d+\b/i
    ];
    function extractSeriesFromTitle(title, subtitle, description, snippet){
      const blob = [title, subtitle, description.slice(0,300), snippet].join(' • ');
      for (const rx of RX){
        const m = blob.match(rx);
        if (m && m[1]){
          let name = m[1].replace(/series$/i,'').trim();
          return {name, num:''};
        }
      }
      return null;
    }

    function groupSeries(items){
      const map = new Map();
      for (const b of items){
        const key = b.series && b.series.name ? b.series.name.trim() : null;
        if(!key) continue;
        if(!map.has(key)) map.set(key, []);
        map.get(key).push(b);
      }
      const groups=[];
      for (const [name, list] of map.entries()){
        list.sort((a,b)=> (a.year||'0000').localeCompare(b.year||'0000') || a.title.localeCompare(b.title));
        const years = list.map(x=>parseInt(x.year||'')).filter(x=>!isNaN(x));
        groups.push({
          name,
          size:list.length,
          from: years.length? Math.min(...years):'',
          to: years.length? Math.max(...years):'',
          languages: Array.from(new Set(list.map(x=>x.language))).filter(Boolean).sort(),
          covers: list.slice(0,3).map(x=>x.cover),
          items:list
        });
      }
      groups.sort((a,b)=> b.size - a.size || a.name.localeCompare(b.name));
      return groups;
    }

    function cardHTML(s){
      const years = s.from && s.to ? `${s.from}–${s.to}` : (s.from||s.to||'');
      const langs = s.languages.join(', ');
      const q = encodeURIComponent(`\"${s.name}\" inpublisher:\"iD01t Productions\" OR inauthor:\"Guillaume Lessard\"`);
      const gbooks = `https://www.google.com/search?q=${q}+site:books.google.com`;
      const covers = (s.covers.length?s.covers:['/assets/img/brand/ebooks_og.jpg']).map(img=>`<img src="${esc(img)}" alt="${esc(s.name)} cover">`).join('');
      return `<article class="card">
        <div class="series-cover">${covers}</div>
        <div class="content">
          <div style="display:flex;justify-content:space-between;gap:10px;align-items:center">
            <h3 style="margin:0">${esc(s.name)}</h3>
            <span class="muted" style="font-size:.9rem">${esc(years)}</span>
          </div>
          <div class="muted">${s.size} book${s.size!==1?'s':''}${langs?` • ${esc(langs)}`:''}</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <a class="btn" href="${gbooks}" target="_blank" rel="noopener nofollow">Google Books</a>
          </div>
        </div>
      </article>`;
    }

    function populateLangFilter(groups){
      const set=new Set(); groups.forEach(g=>g.languages.forEach(l=>set.add(l)));
      $lang.innerHTML = '<option value="">All</option>'+Array.from(set).sort().map(l=>`<option value="${l}">${l}</option>`).join('');
    }

    function applyFilters(groups){
      const text=($q.value||'').toLowerCase(), lang=$lang.value, f=parseInt($from.value||''), t=parseInt($to.value||''), comp=$complete.checked;
      let list = groups.filter(s=>{
        if(text && !s.name.toLowerCase().includes(text)) return false;
        if(lang && !s.languages.includes(lang)) return false;
        if(!isNaN(f) && (s.to||0) < f) return false;
        if(!isNaN(t) && (s.from||0) > t) return false;
        if(comp && s.items.some(x=>!x.year)) return false;
        return true;
      });
      const sort=$sort.value;
      if (sort==='size_asc') list.sort((a,b)=> a.size - b.size || a.name.localeCompare(b.name));
      else if (sort==='date_desc') list.sort((a,b)=> (b.to||0)-(a.to||0));
      else if (sort==='date_asc') list.sort((a,b)=> (a.from||0)-(b.from||0));
      else if (sort==='name_asc') list.sort((a,b)=> a.name.localeCompare(b.name));
      else if (sort==='name_desc') list.sort((a,b)=> b.name.localeCompare(a.name));
      else list.sort((a,b)=> b.size - a.size || a.name.localeCompare(b.name));
      return list;
    }

    function render(list, total){
      if(!list.length){ $grid.innerHTML=''; $empty.hidden=false; $count.textContent='0 series'; $tally.textContent=`0 of ${total}`; return; }
      $empty.hidden=true;
      $grid.innerHTML = list.map(cardHTML).join('');
      $count.textContent = `${list.length} series`;
      $tally.textContent = `${list.length} of ${total} matched`;
      // JSON-LD
      const ld = { '@context':'https://schema.org','@type':'ItemList', name:'Book Series', itemListElement:list.slice(0,60).map((s,i)=>({'@type':'ListItem',position:i+1,item:{'@type':'BookSeries',name:s.name,numberOfBooks:s.size}})) };
      let tag=document.getElementById('ld-series'); if(!tag){tag=document.createElement('script');tag.id='ld-series';tag.type='application/ld+json';document.head.appendChild(tag);} tag.textContent=JSON.stringify(ld);
    }

    function bind(groups){
      const again=()=>render(applyFilters(groups), groups.length);
      ['input','change'].forEach(evt=>[$q,$lang,$from,$to,$sort,$complete].forEach(e=>e.addEventListener(evt,again)));
      $clear.addEventListener('click',()=>{$q.value='';$lang.value='';$from.value='';$to.value='';$sort.value='size_desc';$complete.checked=false;again();});
    }

    (async function init(){
      try{
        // Build union queries
        const queries=[
          ...CONF.AUTHORS.map(a=>`inauthor:"${a}"`),
          ...CONF.PUBLISHERS.map(p=>`inpublisher:"${p}"`)
        ];
        const map=new Map();
        for (const q of queries){
          const vols = await fetchVolumes(q);
          vols.forEach(v=>{
            const n=normalize(v);
            if(!n.title) return;
            const key=(n.title+'|'+(n.year||'')).toLowerCase();
            if(!map.has(key)) map.set(key,n);
          });
        }
        const items = Array.from(map.values());
        const groups = groupSeries(items);
        populateLangFilter(groups);
        bind(groups);
        render(applyFilters(groups), groups.length);
        if(!groups.length){
          $grid.innerHTML='<div class="muted">No series detected from Google metadata. Consider adding “(Series Name Book 1)” patterns to titles/subtitles for better grouping.</div>';
          $empty.hidden=true;
        }
      }catch(err){
        console.warn('Series load failed', err);
        $grid.innerHTML='<div class="muted">Could not load data from Google Books API. Try again later.</div>';
        $empty.hidden=false;
      }
    })();
  </script>
</body>
</html>
